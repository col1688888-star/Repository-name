<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ê©üÂè∞ÁïåÈù¢ ¬∑ Ëá™ÂãïPiPÔºãÊªëËªåÈñãÈóú</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dseg@0.46.0/css/dseg7.min.css">
    <style>
        /* ----- ÂÖ®ÂüüÈáçÁΩÆ ----- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #0b0e14;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px;
            touch-action: manipulation;
            position: relative;
            overflow-x: hidden;
        }

        #playMainArea {
            width: 100%;
            max-width: 400px;
            height: 92vh;
            max-height: 780px;
            background: #10131c;
            border: 2px solid #2a4a5a;
            border-radius: 28px;
            box-shadow: 0 8px 0 #0a121c;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 5;
        }

        /* ÂêÑÂçÄÂüüÊØî‰æã */
        #dataArea { flex: 0 0 28%; min-height: 170px; padding: 8px 8px 4px 8px; position: relative; z-index: 10; }
        #content { flex: 0 0 40%; min-height: 220px; padding: 6px 8px; }
        #panelTop { flex: 0 0 9%; min-height: 58px; }
        #panelBottom { flex: 0 0 13%; min-height: 68px; }
        #commandArea { flex: 0 0 8%; min-height: 48px; }

        /* ----- Ë¶ñË®äËΩâËª∏ÂçÄ ----- */
        .reel-container {
            width: 100%;
            height: 100%;
            display: flex;
            gap: 6px;
            background: #0d121b;
            border-radius: 28px;
            border: 1px solid #2f4457;
            padding: 6px;
            box-shadow: inset 0 3px 6px #00000080, 0 4px 0 #0f1a22;
        }

        .reel {
            flex: 1;
            background: #1b2633;
            border-radius: 16px;
            border: 1px solid #3d5c70;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .reel-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #1b2633;
        }

        .video-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-weight: bold;
            text-shadow: 0 2px 4px #000;
            background: rgba(0,0,0,0.3);
            pointer-events: none;
            z-index: 2;
        }

        /* PiP ÂïüÁî®ÊôÇÁöÑË¶ñË¶∫ÊèêÁ§∫ */
        .pip-active #playMainArea {
            border: 3px solid #f5e37a;
            box-shadow: 0 0 0 3px #c9a244, 0 8px 0 #0a121c;
        }

        /* È†ÇÈÉ®Èù¢ÊùøÊï∏ÂÄºÈ°èËâ≤ */
        #panelTop dl { text-align: center; }
        #panelTop dt {
            font-size: 9px;
            color: #a0c8dd !important;
            font-weight: bold;
        }
        #panelTop dd {
            font-size: 13px;
            font-family: 'DSEG7 Classic', monospace;
            color: #f3de8a !important;
        }

        #medalNum, #bbPoint {
            color: #f3de8a !important;
        }

        /* Â§ßË≥ûÁáàÂÆπÂô® */
        .prize-light-container-special {
            width: 100%;
            height: 100%;
            background: #141a24;
            border: 1px solid #2c4050;
            border-radius: 20px;
            box-shadow: inset 0 2px 4px #00000060;
            overflow: hidden;
            position: relative;
        }

        .prizeLightPages {
            display: flex;
            width: 300%;
            height: 100%;
            transition: transform 0.3s ease-out;
        }

        .prizeLightPage {
            width: 33.333%;
            height: 100%;
            padding: 6px 6px 4px 6px;
            display: flex;
            flex-direction: column;
        }

        .pageHeader {
            flex: 0 0 16%;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            border-bottom: 1px solid #2e4a5a;
            margin-bottom: 4px;
            padding-bottom: 2px;
        }

        .dataTabs {
            display: flex;
            gap: 8px;
        }

        .dataTab {
            height: 24px;
            padding: 0 12px;
            background: #1f2a34;
            border: 1px solid #3e5f70;
            border-radius: 30px;
            color: #b0d4e0;
            font-size: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            letter-spacing: 0.3px;
            cursor: pointer;
            transition: all 0.1s;
        }

        .dataTab.active {
            background: #00b8c4;
            color: #111;
            border-color: #6ec0d0;
            font-weight: bold;
        }

        .pageContent {
            flex: 1;
            display: grid;
            grid-template-columns: 70% 28%;
            gap: 6px;
            overflow: hidden;
            margin-top: 2px;
        }

        .blockChartWrapper {
            background: #0e151f;
            border: 1px solid #2c4053;
            border-radius: 14px;
            padding: 6px 4px;
        }

        .blockChartBars {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: calc(100% - 18px);
            gap: 2px;
        }

        .blockChartBar {
            width: 8%;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            gap: 2px;
        }

        .blockChartBlock {
            width: 100%;
            height: 10px;
            border-radius: 2px;
            border: 1px solid #2d4b5a;
        }

        .block-red { background: #cc3b5e; }
        .block-green { background: #2bb87c; }

        .blockChartValue {
            color: #9fc8d9;
            font-size: 7px;
            font-family: 'DSEG7 Classic', monospace;
        }

        .dataPanel {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .dataCard {
            background: #121b26;
            border: 1px solid #2e4a5e;
            border-radius: 12px;
            padding: 6px 5px;
            box-shadow: 0 2px 0 #0b121c;
        }

        .dataCardHeader {
            font-size: 8px;
            color: #90b8cc;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .dataCardValue {
            font-size: 13px;
            font-family: 'DSEG7 Classic', monospace;
            text-align: right;
            color: #e0eef5;
        }
        .dataCard-total .dataCardValue { color: #f5e37a; }
        .dataCard-bb .dataCardValue { color: #ff8a9f; }
        .dataCard-rb .dataCardValue { color: #8ff0b5; }

        .control-panel {
            background: #141c28;
            border-top: 1px solid #2e4b60;
            border-bottom: 1px solid #2e4b60;
            box-shadow: inset 0 2px 3px #00000050;
        }

        /* ÊåâÈàïÊ®£Âºè */
        .game-btn {
            transition: all 0.1s ease;
            border-radius: 40px;
            font-weight: 800;
            letter-spacing: 0.5px;
            border: 1px solid #4e7a94;
            color: white;
            background: #2c4053;
            box-shadow: 0 4px 0 #0a1a22, 0 2px 4px #000000b0;
        }
        .game-btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #0a1a22, 0 2px 4px #000;
        }
        .btn-red { background: #be3e62; border-color: #d4668a; }
        
        /* ‰øùÁïôÊåâÈàï - ÊîπÂõûÂéüÊú¨ÁöÑÁê•ÁèÄËâ≤ */
        .btn-amber { 
            background: #c47c34; 
            border-color: #efb36e; 
            color: white; 
        }
        
        .btn-green { background: #1f8f6b; border-color: #52c2a0; }
        .btn-purple { background: #8a5fb0; border-color: #b792e6; }
        .btn-gray { background: #3a4b5e; border-color: #6f859b; }

        .stop-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #1f6f8f;
            border: 2px solid #6fb4cf;
            box-shadow: 0 4px 0 #0f3545, 0 2px 6px #000;
            color: white;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .stop-btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #0f3545, 0 2px 4px #000;
        }

        .joystick {
            width: 58px;
            height: 58px;
            background: radial-gradient(circle at 35% 35%, #f0f5fa, #7f8b9c 60%, #3f4d5c 90%);
            border: 2px solid #b0c8dd;
            border-radius: 50%;
            box-shadow: 0 7px 0 #1f3340, 0 10px 12px #000000b0;
            position: relative;
            cursor: pointer;
            transition: all 0.08s linear;
        }

        .status-message {
            position: fixed;
            top: 12px;
            left: 12px;
            right: 12px;
            background: #1d2a36;
            border: 2px solid #3487a7;
            border-radius: 60px;
            padding: 12px 20px;
            color: #dcf0f5;
            font-weight: bold;
            font-size: 14px;
            z-index: 3000;
            text-align: center;
            transform: translateY(-80px);
            transition: transform 0.3s ease;
        }
        .status-message.show { transform: translateY(0); }

        .prize-light-navigation {
            position: absolute;
            bottom: 4px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transform: translateY(8px);
            transition: 0.2s;
        }
        .prize-light-navigation.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }
        .prize-light-touch-zone {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: transparent;
            z-index: 90;
            pointer-events: all;
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }
        .touch-indicator {
            width: 50px;
            height: 5px;
            background: #3b7890;
            border-radius: 20px;
            margin-bottom: 6px;
        }

        /* ÊäΩÂ±úÊ®£Âºè */
        .drawer-trigger-area {
            position: absolute;
            right: 0;
            top: 0;
            width: 28px;
            height: 100%;
            background: transparent;
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: all;
            cursor: pointer;
        }

        .drawer-arrow {
            width: 20px;
            height: 50px;
            background: rgba(27, 59, 75, 0.25);
            backdrop-filter: blur(1px);
            border: 2px solid rgba(59, 122, 153, 0.3);
            border-right: none;
            border-radius: 30px 0 0 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(200, 235, 255, 0.3);
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s ease;
            pointer-events: none;
        }

        .slide-drawer {
            position: absolute;
            right: -220px;
            top: 12px;
            width: 200px;
            background: #1b2633;
            border: 2px solid #2e6a88;
            border-radius: 20px 0 0 20px;
            box-shadow: -4px 6px 0 #0e202b, 0 6px 12px #000;
            z-index: 250;
            transition: right 0.25s ease-out;
            pointer-events: all;
            overflow: hidden;
        }

        .slide-drawer.open { right: 0; }

        .drawer-header {
            background: #1f3e50;
            padding: 8px 10px;
            border-bottom: 2px solid #2e7a9a;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #d0f0ff;
            font-weight: bold;
            font-size: 12px;
        }

        .drawer-content {
            padding: 10px;
            background: #14222e;
        }

        /* PiP ÊªëËªåÈñãÈóú */
        .pip-section {
            background: #1a3342;
            border: 2px solid #2e7a9a;
            border-radius: 16px;
            padding: 15px 10px;
            margin-bottom: 15px;
        }

        .pip-title {
            color: #f5e37a;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            letter-spacing: 1px;
        }

        /* ÊªëËªåÂÆπÂô® */
        .pip-slider-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 10px 0;
        }

        .pip-slider-label {
            color: #8fcae0;
            font-size: 11px;
            min-width: 45px;
        }

        /* ÊªëËªåÊú¨È´î */
        .pip-slider-track {
            flex: 1;
            height: 24px;
            background: #0f2a36;
            border-radius: 30px;
            border: 1px solid #3d7895;
            position: relative;
            cursor: pointer;
            box-shadow: inset 0 2px 5px #000;
        }

        /* ÊªëÂãïÂúìÈªû */
        .pip-slider-thumb {
            width: 34px;
            height: 34px;
            background: #f5e37a;
            border-radius: 50%;
            position: absolute;
            top: -5px;
            left: -2px;
            box-shadow: 0 3px 0 #7a5f2a, 0 2px 8px #000;
            transition: left 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #111;
            font-size: 16px;
            font-weight: bold;
            border: 2px solid #eed685;
        }

        /* ÊªëËªåÁãÄÊÖãÊñáÂ≠ó */
        .pip-slider-status {
            text-align: center;
            margin-top: 10px;
            font-size: 11px;
            color: #8fcae0;
        }
        .pip-slider-status.active {
            color: #f5e37a;
            font-weight: bold;
        }

        .drawer-item {
            background: #1d3342;
            border: 1px solid #2e6078;
            border-radius: 12px;
            padding: 8px 6px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .drawer-item-value {
            margin-left: auto;
            background: #003d55;
            padding: 2px 6px;
            border-radius: 20px;
            font-size: 9px;
            font-family: 'DSEG7 Classic', monospace;
            color: #f5e37a;
        }
    </style>
</head>
<body>
    <div class="status-message" id="statusMessage"></div>

    <!-- ‰∏ªÊ©üÂè∞ -->
    <div id="playMainArea">
        <!-- Â§ßË≥ûÁáàÂçÄ -->
        <div id="dataArea">
            <div class="prize-light-container-special" id="prizeLightContainer">
                <div class="prizeLightPages" id="prizeLightPages">
                    <div class="prizeLightPage" data-page="0">
                        <div class="pageHeader">
                            <div class="dataTabs">
                                <div class="dataTab active" data-type="spins">ËΩâÊï∏</div>
                                <div class="dataTab" data-type="bb">BB</div>
                                <div class="dataTab" data-type="rb">RB</div>
                            </div>
                        </div>
                        <div class="pageContent">
                            <div class="blockChartWrapper">
                                <div class="blockChartBars" id="blockChartBars"></div>
                            </div>
                            <div class="dataPanel">
                                <div class="dataCard dataCard-total"><div class="dataCardHeader">Á∏ΩËΩâÊï∏</div><div class="dataCardValue" id="totalSpinsValue">12,589</div></div>
                                <div class="dataCard dataCard-bb"><div class="dataCardHeader">BBÊ¨°Êï∏</div><div class="dataCardValue" id="bbCountValue">156</div></div>
                                <div class="dataCard dataCard-rb"><div class="dataCardHeader">RBÊ¨°Êï∏</div><div class="dataCardValue" id="rbCountValue">289</div></div>
                            </div>
                        </div>
                    </div>
                    <div class="prizeLightPage" data-page="1">
                        <div class="pageHeader"><div class="dataTabs"><div class="dataTab active">Ê©üÂè∞Â±•Ê≠∑</div></div></div>
                        <div class="history-strategy-content" style="overflow-y:auto; padding:4px;">
                            <div class="history-strategy-list" id="machineHistoryList"></div>
                        </div>
                    </div>
                    <div class="prizeLightPage" data-page="2">
                        <div class="pageHeader"><div class="dataTabs"><div class="dataTab active">Ê©üÂè∞ÊîªÁï•</div></div></div>
                        <div class="history-strategy-content" style="overflow-y:auto; padding:4px;">
                            <div class="history-strategy-list" id="machineStrategyList"></div>
                        </div>
                    </div>
                </div>
                
                <div class="prize-light-touch-zone" id="prizeLightTouchZone"><div class="touch-indicator"></div></div>
                <div class="prize-light-navigation" id="prizeLightNavigation">
                    <button class="cyber-arrow" id="prevPrizeLightPage">‚óÄ</button>
                    <div class="cyber-dots" id="prizeLightDots">
                        <div class="cyber-dot active" data-index="0"></div>
                        <div class="cyber-dot" data-index="1"></div>
                        <div class="cyber-dot" data-index="2"></div>
                    </div>
                    <button class="cyber-arrow" id="nextPrizeLightPage">‚ñ∂</button>
                </div>

                <!-- ÊäΩÂ±ú - ÊªëËªåÈñãÈóú -->
                <div class="drawer-trigger-area" id="drawerTriggerArea">
                    <div class="drawer-arrow" id="drawerArrow">‚óÄ</div>
                </div>
                <div class="slide-drawer" id="slideDrawer">
                    <div class="drawer-header">
                        <span>‚öôÔ∏è Â∑•ÂÖ∑ÊäΩÂ±ú</span>
                        <button id="drawerCloseBtn" style="background:transparent; border:none; color:#8fcae0; font-size:16px;">‚úï</button>
                    </div>
                    <div class="drawer-content">
                        <!-- PiP ÊªëËªåÈñãÈóú -->
                        <div class="pip-section">
                            <div class="pip-title">üì∫ Â≠êÊØçË¶ñË®äÁï´Èù¢</div>
                            
                            <!-- ÊªëËªåÈñãÈóú -->
                            <div class="pip-slider-container">
                                <span class="pip-slider-label">Èóú</span>
                                <div class="pip-slider-track" id="pipSliderTrack">
                                    <div class="pip-slider-thumb" id="pipSliderThumb">‚óâ</div>
                                </div>
                                <span class="pip-slider-label">Èñã</span>
                            </div>
                            
                            <!-- ÁãÄÊÖãÈ°ØÁ§∫ -->
                            <div class="pip-slider-status" id="pipStatus">
                                ‚ö™ Â≠êÊØçÁï´Èù¢ÈóúÈñâ
                            </div>
                        </div>

                        <!-- ÂéüÊú¨ÁöÑÊäΩÂ±úÂÖßÂÆπ -->
                        <div class="drawer-item">
                            <div class="drawer-item-icon">üé∞</div>
                            <div class="drawer-item-text">Ê©üÂè∞Á∑®Ëôü</div>
                            <div class="drawer-item-value">#01</div>
                        </div>
                        <div class="drawer-item">
                            <div class="drawer-item-icon">üíé</div>
                            <div class="drawer-item-text">Â∫´Â≠ò‰ª£Âπ£</div>
                            <div class="drawer-item-value" id="drawerMedal">20</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ë¶ñË®äËΩâËª∏ÂçÄ -->
        <div id="content">
            <div class="reel-container">
                <div class="reel" id="reelL">
                    <video class="reel-video" id="videoL" autoplay loop muted playsinline webkit-playsinline>
                        <source src="#" type="video/mp4">
                    </video>
                    <div class="video-placeholder">üé∞ Â∑¶Ëº™</div>
                </div>
                <div class="reel" id="reelC">
                    <video class="reel-video" id="videoC" autoplay loop muted playsinline webkit-playsinline>
                        <source src="#" type="video/mp4">
                    </video>
                    <div class="video-placeholder">üé∞ ‰∏≠Ëº™</div>
                </div>
                <div class="reel" id="reelR">
                    <video class="reel-video" id="videoR" autoplay loop muted playsinline webkit-playsinline>
                        <source src="#" type="video/mp4">
                    </video>
                    <div class="video-placeholder">üé∞ Âè≥Ëº™</div>
                </div>
            </div>
        </div>

        <!-- È†ÇÈÉ®Èù¢Êùø -->
        <div id="panelTop" class="control-panel">
            <div style="display: flex; align-items: center; height:100%; padding:0 4px;">
                <div style="width:18%;">
                    <button id="maxBet" class="game-btn btn-red" style="width:100%; height:34px;">MAX</button>
                </div>
                <div style="width:60%; display: flex; justify-content: space-around;">
                    <dl>
                        <dt>BB Point</dt>
                        <dd id="bbPoint">8,984,002pt</dd>
                    </dl>
                    <dl>
                        <dt>Medal</dt>
                        <dd id="medalNum">20Coin</dd>
                    </dl>
                </div>
                <div style="width:18%;">
                    <button id="purchaseMedal" class="game-btn btn-red" style="width:100%; height:34px;">BUY</button>
                </div>
            </div>
        </div>

        <!-- Â∫ïÈÉ®Èù¢Êùø -->
        <div id="panelBottom" class="control-panel">
            <div style="display:flex; align-items:center; justify-content:flex-start; height:100%; padding:0 6px;">
                <div style="display:flex; justify-content:center; position:relative; left:25px;">
                    <button class="joystick" id="lever"></button>
                </div>
                <div style="display:flex; justify-content:center; gap:32px; margin-left:70px;">
                    <button class="stop-btn" id="btnStopL">‚èπ</button>
                    <button class="stop-btn" id="btnStopC">‚èπ</button>
                    <button class="stop-btn" id="btnStopR">‚èπ</button>
                </div>
            </div>
        </div>

        <!-- ÂëΩ‰ª§ÂçÄ - ‰øùÁïôÊåâÈàïÈ°èËâ≤Â∑≤ÊîπÂõûÁê•ÁèÄËâ≤ -->
        <div id="commandArea" class="control-panel">
            <div style="display:flex; height:100%; gap:5px; padding:0 4px;">
                <button id="btnHome" class="game-btn btn-gray" style="flex:1;">È¶ñÈ†Å</button>
                <button id="btnReserve" class="game-btn btn-amber" style="flex:1;">‰øùÁïô</button>
                <button id="btnBreak" class="game-btn btn-green" style="flex:1;">Èõ¢Èñã</button>
                <button id="btnAuto" class="game-btn btn-purple" style="flex:1;">Ëá™Âãï</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            const statusMsg = document.getElementById('statusMessage');
            
            function showMessage(msg, type = 'info') {
                statusMsg.innerText = msg;
                statusMsg.style.borderColor = type === 'error' ? '#c6574a' : (type === 'success' ? '#3fa38c' : '#3487a7');
                statusMsg.classList.add('show');
                setTimeout(() => statusMsg.classList.remove('show'), 2500);
            }

            // Ë¶ñË®äÂÖÉÁ¥†
            const videos = [
                document.getElementById('videoL'),
                document.getElementById('videoC'),
                document.getElementById('videoR')
            ];

            // Ê®°Êì¨Ë¶ñË®ä‰∏≤ÊµÅ
            function createMockVideo() {
                const canvas = document.createElement('canvas');
                canvas.width = 320;
                canvas.height = 240;
                const ctx = canvas.getContext('2d');
                
                let frame = 0;
                const stream = canvas.captureStream(30);
                
                setInterval(() => {
                    ctx.fillStyle = '#1b2633';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    const symbols = ['7', 'üçí', '‚≠ê', 'üçã', 'üîî'];
                    const symbol = symbols[Math.floor(frame / 15) % symbols.length];
                    
                    ctx.font = 'bold 80px Arial';
                    ctx.fillStyle = '#c0e2f0';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(symbol, canvas.width/2, canvas.height/2);
                    
                    ctx.strokeStyle = '#3d5c70';
                    ctx.lineWidth = 4;
                    ctx.strokeRect(2, 2, canvas.width-4, canvas.height-4);
                    
                    frame++;
                }, 100);
                
                return stream;
            }

            // Ë®≠ÂÆöË¶ñË®ä‰∏≤ÊµÅ
            videos.forEach(video => {
                const stream = createMockVideo();
                video.srcObject = stream;
            });

            // ÈÅäÊà≤ÁãÄÊÖã
            let currentMachine = { 
                totalSpins: 12589, 
                bbCount: 156, 
                rbCount: 289, 
                medalCount: 20, 
                bbPoint: 8984002 
            };
            
            function updateDisplay() {
                document.getElementById('totalSpinsValue').innerText = currentMachine.totalSpins.toLocaleString();
                document.getElementById('bbCountValue').innerText = currentMachine.bbCount;
                document.getElementById('rbCountValue').innerText = currentMachine.rbCount;
                document.getElementById('medalNum').innerText = currentMachine.medalCount + 'Coin';
                document.getElementById('bbPoint').innerText = currentMachine.bbPoint.toLocaleString() + 'pt';
                document.getElementById('drawerMedal').innerText = currentMachine.medalCount;
            }
            updateDisplay();

            // ÊªæËº™ÈÇèËºØ
            let rolling = false;
            let autoMode = false;
            let autoInterval = null;

            function spinOnce() {
                if (currentMachine.medalCount <= 0) { 
                    showMessage('‰ª£Âπ£‰∏çË∂≥','error');
                    if (autoMode) stopAutoMode();
                    return false;
                }
                currentMachine.medalCount--;
                currentMachine.totalSpins++;
                updateDisplay();
                
                videos.forEach(video => {
                    video.play().catch(e => {});
                });
                
                rolling = true;
                showMessage('ÊªæËº™ËΩâÂãï‰∏≠');
                return true;
            }

            function stopAutoMode() {
                autoMode = false;
                document.getElementById('btnAuto').classList.remove('btn-green');
                document.getElementById('btnAuto').innerText = 'Ëá™Âãï';
                if (autoInterval) {
                    clearInterval(autoInterval);
                    autoInterval = null;
                }
            }

            // ÊêñÊ°ø
            document.getElementById('lever').addEventListener('click', ()=>{
                if (autoMode) {
                    showMessage('Ë´ãÂÖàÈóúÈñâËá™ÂãïÊ®°Âºè','error');
                    return;
                }
                spinOnce();
            });

            // ÂÅúÊ≠¢ÊåâÈàï
            const stops = ['btnStopL','btnStopC','btnStopR'].map(id => document.getElementById(id));
            stops.forEach((btn, i) => {
                btn.addEventListener('click', ()=>{
                    if (!rolling || autoMode) return;
                    rolling = false;
                    showMessage(`Á¨¨${i+1}Ëº™ÂÅúÊ≠¢`);
                });
            });

            // Ëá™ÂãïÊåâÈàï
            document.getElementById('btnAuto').addEventListener('click', ()=>{
                if (autoMode) {
                    stopAutoMode();
                    showMessage('Ëá™ÂãïÊ®°ÂºèÈóúÈñâ');
                } else {
                    autoMode = true;
                    document.getElementById('btnAuto').classList.add('btn-green');
                    document.getElementById('btnAuto').innerText = 'Ëá™Âãï‰∏≠';
                    showMessage('Ëá™ÂãïÊ®°ÂºèÂïüÂãï', 'success');
                    
                    if (!rolling) spinOnce();
                    
                    if (autoInterval) clearInterval(autoInterval);
                    autoInterval = setInterval(() => {
                        if (!autoMode) return;
                        spinOnce();
                    }, 3000);
                }
            });

            // ===== PiP ÊªëËªåÈñãÈóú =====
            const sliderTrack = document.getElementById('pipSliderTrack');
            const sliderThumb = document.getElementById('pipSliderThumb');
            const pipStatus = document.getElementById('pipStatus');
            
            let pipEnabled = false;  // PiP ÈñãÈóúÁãÄÊÖã

            // Êõ¥Êñ∞ÊªëËªå‰ΩçÁΩÆÂíåÁãÄÊÖã
            function updateSliderPosition() {
                if (pipEnabled) {
                    sliderThumb.style.left = 'calc(100% - 34px)';
                    pipStatus.innerHTML = '‚úÖ Â≠êÊØçÁï´Èù¢ÂïüÁî®‰∏≠';
                    pipStatus.classList.add('active');
                    document.body.classList.add('pip-active');
                } else {
                    sliderThumb.style.left = '-2px';
                    pipStatus.innerHTML = '‚ö™ Â≠êÊØçÁï´Èù¢ÈóúÈñâ';
                    pipStatus.classList.remove('active');
                    document.body.classList.remove('pip-active');
                }
            }

            // ÂòóË©¶ÈÄ≤ÂÖ• PiP
            async function enterPiP() {
                try {
                    // iOS Safari ÈúÄË¶ÅÁî®Êà∂ÊâãÂã¢ÊâçËÉΩÈÄ≤ÂÖ• PiP
                    // ÊàëÂÄë‰ΩøÁî®Á¨¨‰∏ÄÂÄãË¶ñË®ä‰æÜÂòóË©¶
                    if (videos[0].webkitSupportsPresentationMode && 
                        videos[0].webkitSupportsPresentationMode('picture-in-picture')) {
                        
                        await videos[0].webkitSetPresentationMode('picture-in-picture');
                        pipEnabled = true;
                        updateSliderPosition();
                        showMessage('Â≠êÊØçÁï´Èù¢Â∑≤ÂïüÂãï', 'success');
                    } else {
                        showMessage('Ê≠§ÁÄèË¶ΩÂô®‰∏çÊîØÊè¥Â≠êÊØçÁï´Èù¢', 'error');
                        pipEnabled = false;
                        updateSliderPosition();
                    }
                } catch (err) {
                    console.log('PiP ÂïüÂãïÂ§±Êïó:', err);
                    showMessage('Ë´ãÂÖàÈªûÊìäÁï´Èù¢ÂïüÂãïË¶ñË®ä', 'error');
                    pipEnabled = false;
                    updateSliderPosition();
                }
            }

            // Èõ¢Èñã PiP
            function exitPiP() {
                videos.forEach(v => {
                    if (v.webkitPresentationMode === 'picture-in-picture') {
                        v.webkitSetPresentationMode('inline');
                    }
                });
                pipEnabled = false;
                updateSliderPosition();
                showMessage('Â∑≤ÈÄÄÂá∫Â≠êÊØçÁï´Èù¢');
            }

            // Áõ£ËÅΩ PiP ÁãÄÊÖãËÆäÂåñ
            videos.forEach(v => {
                v.addEventListener('webkitpresentationmodechanged', () => {
                    const active = videos.some(v => v.webkitPresentationMode === 'picture-in-picture');
                    if (active !== pipEnabled) {
                        pipEnabled = active;
                        updateSliderPosition();
                    }
                });
            });

            // ÊªëËªåÈªûÊìä‰∫ã‰ª∂
            sliderTrack.addEventListener('click', (e) => {
                const rect = sliderTrack.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const midPoint = rect.width / 2;
                
                if (clickX > midPoint) {
                    // ÈªûÊìäÂè≥ÂçäÈÇä -> ÈñãÂïü
                    if (!pipEnabled) {
                        enterPiP();
                    }
                } else {
                    // ÈªûÊìäÂ∑¶ÂçäÈÇä -> ÈóúÈñâ
                    if (pipEnabled) {
                        exitPiP();
                    }
                }
            });

            // ‰πüÂèØ‰ª•ÊãñÊõ≥ÂúìÈªûÔºàÁ∞°ÂåñÁâàÔºâ
            let isDragging = false;
            
            sliderThumb.addEventListener('touchstart', (e) => {
                isDragging = true;
                e.preventDefault();
            });

            document.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                e.preventDefault();
                
                const touch = e.touches[0];
                const rect = sliderTrack.getBoundingClientRect();
                let x = touch.clientX - rect.left - 17; // ÂúìÈªûÂØ¨Â∫¶‰∏ÄÂçä
                
                // ÈôêÂà∂ÁØÑÂúç
                x = Math.max(-2, Math.min(rect.width - 34, x));
                
                sliderThumb.style.left = x + 'px';
            });

            document.addEventListener('touchend', (e) => {
                if (!isDragging) return;
                isDragging = false;
                
                const rect = sliderTrack.getBoundingClientRect();
                const thumbLeft = parseInt(sliderThumb.style.left) || -2;
                const midPoint = rect.width / 2 - 17;
                
                if (thumbLeft > midPoint) {
                    // ÊªëÂà∞Âè≥ÈÇä -> ÈñãÂïü
                    if (!pipEnabled) {
                        enterPiP();
                    } else {
                        updateSliderPosition(); // Á¢∫‰øù‰ΩçÁΩÆÊ≠£Á¢∫
                    }
                } else {
                    // ÊªëÂà∞Â∑¶ÈÇä -> ÈóúÈñâ
                    if (pipEnabled) {
                        exitPiP();
                    } else {
                        updateSliderPosition(); // Á¢∫‰øù‰ΩçÁΩÆÊ≠£Á¢∫
                    }
                }
            });

            // Ë≥ºË≤∑‰ª£Âπ£
            document.getElementById('purchaseMedal').addEventListener('click', ()=>{
                if (currentMachine.bbPoint >= 50) {
                    currentMachine.bbPoint -= 50;
                    currentMachine.medalCount += 50;
                    updateDisplay();
                    showMessage('Ë≥ºË≤∑50‰ª£Âπ£','success');
                } else showMessage('BBÈªû‰∏çË∂≥','error');
            });

            // Â§ßË≥ûÁáàÂ∞éËà™
            const pages = document.getElementById('prizeLightPages');
            const dots = document.querySelectorAll('.cyber-dot');
            const prev = document.getElementById('prevPrizeLightPage');
            const next = document.getElementById('nextPrizeLightPage');
            let curPage = 0;
            
            function setPage(p) {
                if (p<0||p>2) return;
                curPage = p;
                pages.style.transform = `translateX(-${p*33.333}%)`;
                dots.forEach((d,i)=> d.classList.toggle('active', i===p));
                showNav();
            }
            
            prev.addEventListener('click', ()=> setPage(curPage-1));
            next.addEventListener('click', ()=> setPage(curPage+1));
            dots.forEach(d=> d.addEventListener('click', function(){ setPage(parseInt(this.dataset.index)); }));

            const nav = document.getElementById('prizeLightNavigation');
            const zone = document.getElementById('prizeLightTouchZone');
            let hideTimer;
            
            function showNav() { 
                nav.classList.add('active'); 
                clearTimeout(hideTimer); 
                hideTimer = setTimeout(()=> nav.classList.remove('active'), 4000); 
            }
            
            zone.addEventListener('touchstart', showNav);

            // ÂÖ∂‰ªñÊåâÈàï
            document.getElementById('btnReserve').addEventListener('click', ()=> showMessage('‰øùÁïôÂäüËÉΩ'));  // È°èËâ≤Â∑≤ÊîπÂõû
            document.getElementById('maxBet').addEventListener('click', ()=> showMessage('MAX BET'));
            document.getElementById('btnHome').addEventListener('click', ()=> showMessage('È¶ñÈ†Å'));
            document.getElementById('btnBreak').addEventListener('click', ()=> { 
                showMessage('Èõ¢Èñã'); 
                stopAutoMode(); 
            });

            // Â±•Ê≠∑ÂíåÊîªÁï•
            document.getElementById('machineHistoryList').innerHTML = '<div style="color:#c0ddec;">¬∑ 02/15 ÊúÄÂ§ßÁçé8500</div><div style="color:#c0ddec;">¬∑ 02/12 BBÈÄ£Áôº2Ê¨°</div>';
            document.getElementById('machineStrategyList').innerHTML = '<div style="color:#c0ddec;">üìå 20:00ÂæåRBÊ©üÁéáËºÉÈ´ò</div><div style="color:#c0ddec;">üìå ÈÄ£10Ê≤í‰∏≠ÂèØÁï•Â¢ûÊ≥®</div>';

            // ÊäΩÂ±úÊéßÂà∂
            const triggerArea = document.getElementById('drawerTriggerArea');
            const drawer = document.getElementById('slideDrawer');
            const closeBtn = document.getElementById('drawerCloseBtn');
            
            triggerArea.addEventListener('click', (e) => { 
                e.stopPropagation(); 
                drawer.classList.toggle('open'); 
            });
            
            closeBtn.addEventListener('click', (e) => { 
                e.stopPropagation(); 
                drawer.classList.remove('open'); 
            });
            
            document.addEventListener('click', (e) => {
                if (!drawer.contains(e.target) && !triggerArea.contains(e.target)) {
                    drawer.classList.remove('open');
                }
            });

            // ÂïüÂãïË¶ñË®ä
            document.addEventListener('touchstart', () => {
                videos.forEach(v => {
                    if (v.paused) {
                        v.play().catch(e => {});
                    }
                });
            }, { once: true });

            // Ëá™ÂãïÊ®°Âºè + PiP Ëá™ÂãïÈñãÂïü
            // Áï∂Ëá™ÂãïÊ®°ÂºèÂïüÂãïÊôÇÔºåËá™ÂãïÈñãÂïü PiP
            const originalStartAutoMode = startAutoMode;
            window.startAutoMode = function() {
                if (!autoMode) {
                    autoMode = true;
                    document.getElementById('btnAuto').classList.add('btn-green');
                    document.getElementById('btnAuto').innerText = 'Ëá™Âãï‰∏≠';
                    showMessage('Ëá™ÂãïÊ®°ÂºèÂïüÂãïÔºåËá™ÂãïÈñãÂïüÂ≠êÊØçÁï´Èù¢', 'success');
                    
                    // Ëá™ÂãïÈñãÂïü PiP
                    if (!pipEnabled) {
                        setTimeout(() => enterPiP(), 500);
                    }
                    
                    if (!rolling) spinOnce();
                    
                    if (autoInterval) clearInterval(autoInterval);
                    autoInterval = setInterval(() => {
                        if (!autoMode) return;
                        spinOnce();
                    }, 3000);
                }
            };
        })();
    </script>
</body>
</html>
